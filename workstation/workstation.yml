---
- name: Setup workstation
  hosts: localhost
  connection: local
  gather_facts: False

  tasks:
    - include_vars: ~/.ro/workstation-vars.yml

    - name: Ensure ~/workspace doesn't exist as a directory
      stat: path='~/workspace'
      register: workspace
      failed_when: (workspace.stat.exists == True) and (workspace.stat.isdir is defined and workspace.stat.isdir == True)

    - name: Ensure ~/workspace/projects
      file:
         path: ~/workspace/projects
         state: directory

    - name: Place shell helper script
      copy:
        src: files/pentagon-helpers.sh
        dest: ~/.ro/pentagon-helpers.sh
        force: no

    - name: Install Python bits
      pip:
        requirements: "{{ pentagon_repo_path }}/requirements.txt"
        extra_args: "--user"

    - name: symlink to hooks
      file:
        src: "{{ pentagon_repo_path }}/workstation/hooks"
        dest: ~/workspace/hooks
        state: link

    - name: ensure help script gets sourced
      lineinfile: >
        regexp='^source ~/.ro/pentagon-helpers.sh'
        line='source ~/.ro/pentagon-helpers.sh'
        state=present
        dest=~/.bash_profile


