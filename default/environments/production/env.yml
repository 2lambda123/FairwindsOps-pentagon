---

env: "production"
log_path: "/srv/shared/log"
app_home: "/srv/tesla"
aws_key_name: "berrysmoke-2016-01-27"
path_to_bundle: '/usr/local/bin/bundle'
secrets_bucket: 'berrysmoke-production'

## Needs sorting
app_name: 'bsmoke'
app_repo: 'git@github.com:reactiveops/berrysmoke-web.git'
# app_git_ref: "rt-reactiveops"
app_user_name: "deploy"
app_path: "/srv/bsmoke"
##

rds_subnet_group_name: "{{ env }}-rds"

private_subnets:
  - "{{ private_prod_az1 }}"
  - "{{ private_prod_az2 }}"
  - "{{ private_prod_az3 }}"

stacks:
  tesla:
    stack_name: 'tesla'
    instance_profile_name: 'production_tesla' # env_stack
    default_app_repo: 'git@github.com:reactiveops/berrysmoke-web.git'
    default_app_name: 'bsmoke'
    layers:
      web:
        instance_profile_name: 'production_tesla' # env_stack
        elb_name: production-tesla-app # env-stack-layer
        instance_type: 't2.micro'
        deploy_name: 'production-tesla-app'  # env-stack-layer
        asg_name: 'production-tesla-app'
        min_size: 1
        max_size: 1
        desired_capacity: 1
        replace_batch_size: 1
        health_check_period: 300
        health_check_type: 'ELB'
        temp_elb_health_check_ping_port: 80
        wait_timeout: 480
        replace_all_instances: 'yes'
        # Subnets for the temp ELB are defined here:
        vpc_zone_identifier:
          - 'subnet-99cbadc1'
          - 'subnet-96dc44bc'
          - 'subnet-4b612a3d'
        availability_zones:
          - "us-east-1a"
          - "us-east-1c"
          - "us-east-1d"
        post_instantiantion_playbook_path: '/srv/shared/instance-config.yml'
        volumes:
            - device_name: /dev/sda1
              volume_size: 30
              device_type: 'gp2'
              delete_on_termination: True
      worker:
        # dev-tesla-worker needs to be created
        instance_profile_name: 'production_tesla'
        asg_name: 'production-tesla-worker'
        post_instantiantion_playbook_path: '/srv/shared/instance-config.yml'
        instance_type: 't2.micro'
        health_check_period: 210
        health_check_type: 'ELB'
        replace_all_instances: 'no'
        replace_batch_size: 1
        min_size: 1
        max_size: 1
        desired_capacity: 1
        vpc_zone_identifier:
          - 'subnet-99cbadc1'
          - 'subnet-96dc44bc'
          - 'subnet-4b612a3d'
        availability_zones:
          - "us-east-1a"
          - "us-east-1c"
          - "us-east-1d"
        volumes:
            - device_name: /dev/sda1
              volume_size: 30
              device_type: 'gp2'
              delete_on_termination: True
      default_elb:
        name: production-tesla-app
        scheme: 'internet-facing'
        # needs to be set dynamically
        security_group_names: sg-400dc03b
        subnets:
          - 'subnet-98cbadc0'
          - 'subnet-97dc44bd'
          - 'subnet-48612a3e'
        listeners:
          - protocol: http
            load_balancer_port: 80
            instance_port: 80
          - protocol: https
            load_balancer_port: 443
            instance_protocol: http
            instance_port: 80
            ssl_certificate_id: "{{ wildcard_ssl_certificate_arn }}"
        health_check:
          ping_protocol: tcp
          ping_port: 80
          response_timeout: 5
          interval: 30
          unhealthy_threshold: 2
          healthy_threshold: 2
        set_dns: true
        dns_overwrite: true
        dns_zone: 'berrysmoke.com'
      memcached:
        ec_cluster_id: "rt-{{ env }}"
        ec_cluster_name: "tesla-memcached-{{ env }}"
        ec_engine: 'memcached'
        ec_engine_version: '1.4.24'
        ec_nodetype: 'cache.t2.small'
        cache_subnet_group: "{{ env }}-cache"
        security_group_ids: "{{ env }}_data"
        num_nodes: 1
      rds:
        db_engine: 'postgres'
        size: 50
        instance_type: 'db.t2.small'


# App settings
rails_env: "production"
rack_env: "production"

public_es_whitelist: []

# role: ssmtp
# ssmtp_mailhub: 'mailtrap.io:465'
# ssmtp_auth_user: '167745e753cedd6fb'
# ssmtp_rewrite_domain: 'tesladev.com'
# ssmtp_hostname: 'tesladev.com'

# role: "elao.cron"
cron: []


# role: "reactiveops.supervisor-master"
supervisor: []
