---

- name: configure stackstorm instance
  hosts: tag_Layer_stackstorm

  pre_tasks:
    - include_vars: "{{item}}"
      with_items:
        - ../../../account/vars.yml
        - ../env.yml
      tags: always

    # - name: get secrets.yml from S3
    #   s3:
    #     bucket: "{{ secrets_bucket }}"
    #     object: "secrets.yml"
    #     mode: 'getstr'
    #   register: secrets
    #   changed_when: false

    # - set_fact:
    #     "{{item}}": "{{(secrets.contents|from_yaml)['all'][item]}}"
    #   with_items:
    #     - jumpcloud_connect_key


  roles:
    # - role: jumpcloud
    #   jumpcloud_x_connect_key: "{{ jumpcloud_connect_key }}"
    #   jumpcloud_use_sudo: yes

    - role: reactiveops.stackstorm
